!function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function i(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return n(t,void 0);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,void 0):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(i=t[Symbol.iterator]()).next.bind(i)}function r(t,e){if(t instanceof CSSUnitValue||t instanceof CSSMathSum)return t;if(!e)return null;var n=t.trim().match(/^(-?[0-9]*\.?[0-9]*)(px|%)$/);return n?new CSSUnitValue(n[1],"%"==n[2]?"percent":n[2]):null}var a=new CSSKeywordValue("auto"),o=new WeakMap,l=[];function s(t){return t===document.scrollingElement?document:t}function u(t){var e=o.get(t).animations;if(0!==e.length)for(var n=t.currentTime,i=0;i<e.length;i++)e[i].tickAnimation(n)}function c(t,e,n,o,l){if(l)return l(e,n,o,0==t.value?"start":"end");"block"===n?n="vertical":"inline"===n&&(n="horizontal");var s="vertical"===n?e.scrollHeight-e.clientHeight:e.scrollWidth-e.clientWidth;return function t(e,n){if(e instanceof CSSUnitValue){if("percent"==e.unit)return e.value*n/100;if("px"==e.unit)return e.value;throw TypeError("Unhandled unit type "+e.unit)}if(e instanceof CSSMathSum){for(var r,a=0,o=i(e.values);!(r=o()).done;)a+=t(r.value,n);return a}throw TypeError("Unsupported value type: "+typeof e)}(r(o===a?t:o),s)}function f(t,e){for(var n=o.get(t).animations,i=0;i<n.length;i++)n[i].animation==e&&n.splice(i,1)}function m(t,e,n){for(var i=o.get(t).animations,r=0;r<i.length;r++)if(i[r].animation==e)return;i.push({animation:e,tickAnimation:n}),u(t)}var h=function(){function t(t){o.set(this,{scrollSource:null,orientation:"block",startScrollOffset:a,endScrollOffset:a,scrollOffsets:[],timeRange:a,animations:[],scrollOffsetFns:[]}),this.scrollSource=t&&void 0!==t.scrollSource?t.scrollSource:document.scrollingElement,this.orientation=t&&t.orientation||"block",this.startScrollOffset=t&&t.startScrollOffset||a,this.endScrollOffset=t&&t.endScrollOffset||a,this.scrollOffsets=t&&void 0!==t.scrollOffsets?t.scrollOffsets:[],this.timeRange=t&&void 0!==t.timeRange?t.timeRange:"auto"}return e(t,[{key:"scrollSource",set:function(t){var e=this;this.scrollSource&&s(this.scrollSource).removeEventListener("scroll",function(){return u(e)}),o.get(this).scrollSource=t,t&&s(t).addEventListener("scroll",function(){return u(e)}),u(this)},get:function(){return o.get(this).scrollSource}},{key:"orientation",set:function(t){if(-1===["block","inline","horizontal","vertical"].indexOf(t))throw TypeError("Invalid orientation");o.get(this).orientation=t,u(this)},get:function(){return o.get(this).orientation}},{key:"scrollOffsets",set:function(t){for(var e,n=[],s=[],u=i(t);!(e=u()).done;){var c=e.value,f=null,m=void 0;"auto"==c&&(c=a);for(var h=0;h<l.length;h++){var g=l[h].parse(c);if(void 0!==g){m=g,f=l[h].evaluate;break}}if(!f){if(c!=a){var d=r(c);if(!d||d instanceof CSSUnitValue&&"number"==d.unit)throw TypeError("Invalid scrollOffsets entry.")}m=c}n.push(m),s.push(f)}if(1==n.length&&n[0]==a)throw TypeError("Invalid scrollOffsets value.");var p=o.get(this);p.scrollOffsets=n,p.scrollOffsetFns=s},get:function(){return o.get(this).scrollOffsets}},{key:"startScrollOffset",set:function(t){"auto"==t&&(t=a);var e=o.get(this);e.startScrollOffsetFunction=null;for(var n=0;n<l.length;n++){var i=l[n].parse(t);if(void 0!==i){t=i,e.startScrollOffsetFunction=l[n].evaluate;break}}if(t!=a&&!o.get(this).startScrollOffsetFunction){var s=r(t);if(!s||s instanceof CSSUnitValue&&"number"==s.unit)throw TypeError("Invalid start offset.")}e.startScrollOffset=t,u(this)},get:function(){return o.get(this).startScrollOffset}},{key:"endScrollOffset",set:function(t){"auto"==t&&(t=a),o.get(this).endScrollOffsetFunction=null;for(var e=0;e<l.length;e++){var n=l[e].parse(t);if(void 0!==n){t=n,o.get(this).endScrollOffsetFunction=l[e].evaluate;break}}if(t!=a&&!o.get(this).startScrollOffsetFunction){var i=r(t);if(!i||i instanceof CSSUnitValue&&"number"==i.unit)throw TypeError("Invalid end offset.")}o.get(this).endScrollOffset=t,u(this)},get:function(){return o.get(this).endScrollOffset}},{key:"timeRange",set:function(t){if("auto"!=t&&("number"!=typeof t||!Number.isFinite(t)||t!=t))throw TypeError("Invalid timeRange value");o.get(this).timeRange=t,u(this)},get:function(){return o.get(this).timeRange}},{key:"phase",get:function(){if(!this.scrollSource)return"inactive";var t=getComputedStyle(this.scrollSource);if("none"==t.display)return"inactive";if(this.scrollSource!=document.scrollingElement&&("visible"==t.overflow||"clip"==t.overflow))return"inactive";var e=c(new CSSUnitValue(0,"percent"),this.scrollSource,this.orientation,this.startScrollOffset,o.get(this).startScrollOffsetFunction),n=c(new CSSUnitValue(100,"percent"),this.scrollSource,this.orientation,this.endScrollOffset,o.get(this).endScrollOffsetFunction),i=c(new CSSUnitValue(100,"percent"),this.scrollSource,this.orientation,new CSSUnitValue(100,"percent"),null);if(null===e||null===n)return"inactive";var r=this.scrollSource.scrollTop;return"inline"!==this.orientation&&"horizontal"!==this.orientation||(r=this.scrollSource.scrollLeft),r<e?"before":r>=n&&n<i?"after":"active"}},{key:"currentTime",get:function(){if(!this.scrollSource)return null;if("inactive"==this.phase)return null;var t=c(new CSSUnitValue(0,"percent"),this.scrollSource,this.orientation,this.startScrollOffset,o.get(this).startScrollOffsetFunction),e=c(new CSSUnitValue(100,"percent"),this.scrollSource,this.orientation,this.endScrollOffset,o.get(this).endScrollOffsetFunction),n=function(t){var e=t.timeRange;if(e==a){e=0;for(var n=o.get(t).animations,i=0;i<n.length;i++)e=Math.max(e,n[i].animation.effect.getComputedTiming().activeDuration);Infinity===e&&(e=0)}return e}(this),i=this.scrollSource.scrollTop;return"inline"!==this.orientation&&"horizontal"!==this.orientation||(i=this.scrollSource.scrollLeft),console.log("currentScrollOffset: "+i),console.log("startOffset: "+t),console.log("endOffset: "+e),i<t?0:i>=e?n:(i-t)/(e-t)*n}},{key:"__polyfill",get:function(){return!0}}]),t}(),g=window.Element.prototype.animate,d=window.Animation;function p(t){var e=++t.sequence,n=t.readyPromise=new Promise(function(i,r){requestAnimationFrame(function(){if(t.readyPromise==n&&(t.readyPromise=null),t.aborted.has(e))return t.aborted.delete(e),void r(new DOMException("Animation aborted","AbortError"));if(null!==t.pendingPlaybackRate){var a=t.animation.currentTime;t.animation.playbackRate=t.pendingPlaybackRate,t.startTime=t.pendingPlaybackRate?t.timeline.currentTime-a/t.pendingPlaybackRate:a,t.pendingPlaybackRate=null}switch(t.playState){case"paused":t.startTime=null;break;case"running":case"finished":t.holdTime=null}i()})})}function y(t){return t.pendingPlaybackRate?t.pendingPlaybackRate:t.animation.playbackRate}function v(t){t.pendingPlaybackRate&&(t.animation.playbackRate=t.pendingPlaybackRate,t.pendingPlaybackRate=null)}function S(t){if(t.timeline&&("running"==t.playState||"finished"==t.playState)){var e,n,i=(e=y(t),n=t.animation.currentTime,e<0&&n<=0||e>0&&n>=t.animation.effect.getTiming().duration?"finished":"running");i!=t.playState&&(t.playState=i,"finished"==i&&requestAnimationFrame(function(){if("finished"==t.playState){var e=t.animation.currentTime;t.animation.finish(),t.animation.pause(),t.animation.currentTime=e}}))}}function T(t){console.log("tickAnimation("+t+")");var e=b.get(this);null!=t?"running"==this.playState&&(e.animation.currentTime=(t-this.startTime)*this.playbackRate,S(e)):"idle"!=e.animation.playState&&e.animation.cancel()}var b=new WeakMap,k=function(){function t(t,e){var n=t instanceof d?t:new d(t,r),i=e instanceof h,r=i?void 0:e;b.set(this,{animation:n,timeline:i?e:void 0,playState:i?"idle":null,readyPromise:null,startTime:null,holdTime:null,resetCurrentTimeOnResume:!1,pendingPlaybackRate:null,proxy:this,sequence:0,aborted:new Set})}var n=t.prototype;return n.finish=function(){var t=b.get(this);if(t.timeline){var e=y(t),n=t.animation.effect.getTiming().duration;if(0==e||e<0&&Infinity==n)t.animation.finish();else{v(t);var i=e<0?0:n,r=t.timeline.currentTime;t.animation.currentTime=i,function(t){return!t.timeline||"inactive"!=t.timeline.phase}(t)?(t.startTime=r-i/e,t.holdTime=null,t.playState="finished",f(t.timeline,t.animation),t.readyPromise=null,t.animation.finish()):(t.startTime=null,t.holdTime=i,t.playState="paused")}}else t.animation.finish()},n.play=function(){var t=b.get(this);if(t.timeline){var e=t.animation.currentTime;t.resetCurrentTimeOnResume&&(e=null,t.resetCurrentTimeOnResume=!1);var n=y(t),i=t.animation.effect.getTiming().duration,r=null;n>0&&(null==e||e<0||e>=i)?r=0:n<0&&(null==e||e<=0||e>i)?r=i:0==n&&null==e&&(r=0),t.playState="running",null!=r?this.startTime=r:this.currentTime=e,m(t.timeline,t.animation,T.bind(this)),t.readyPromise||p(t)}else t.animation.play()},n.pause=function(){var t=b.get(this);if(t.animation.pause(),t.timeline&&"paused"!=t.playState){var e=t.animation.currentTime;e?t.holdTime=e:t.startTime=y(t)<0?t.animation.effect.getTiming().duration:0,t.playState="paused",f(t.timeline,t.animation),t.readyPromise||p(t)}},n.reverse=function(){var t=b.get(this);if(t.timeline){var e=y(t),n=t.animation.effect.getTiming().duration;0==e||e>0&&Infinity==n?t.animation.reverse():(this.updatePlaybackRate(-e),this.play())}else t.animation.reverse()},n.updatePlaybackRate=function(t){var e=b.get(this);if(e.pendingPlaybackRate=t,e.timeline)switch(e.playState){case"idle":case"paused":v(e);break;case"finished":case"running":p(e),S(e)}else e.animation.updatePlaybackRate(t)},n.persist=function(){b.get(this).animation.persist()},n.cancel=function(){var t=b.get(this);t.animation.cancel(),t.timeline&&(t.startTime=null,t.holdTime=null,t.playState="idle",f(t.timeline,t.animation),t.readyPromise&&(t.aborted.add(t.sequence),t.readyPromise=null))},e(t,[{key:"effect",get:function(){return b.get(this).animation.effect},set:function(t){b.get(this).animation.effect=t}},{key:"timeline",get:function(){var t=b.get(this);return t.timeline||t.animation.timeline},set:function(t){var e=this.timeline;if(e!=t){var n=b.get(this),i=e instanceof h,r=t instanceof h,a=this.currentTime,o=this.playState,l=y(n),s=this.pending;if(i&&f(n.timeline,n.animation),n.resetCurrentTimeOnResume=!1,r){switch(n.timeline=t,v(n),n.animation.pause(),o){case"idle":n.playState="idle",n.holdTime=null,n.startTime=null;break;case"paused":n.playState="paused",n.resetCurrentTimeOnResume=!0,n.animation.currentTime=a,f(n.timeline,n.animation);break;case"running":case"finished":n.playState=o,n.startTime=l<0?n.animation.effect.getTiming().duration:0,n.holdTime="finished"==o?a:null,m(n.timeline,n.animation,T.bind(this))}s&&p(n)}else{if(n.animation.timeline!=t)throw TypeError("Unsupported timeline: "+t);if(i)switch(n.timeline=null,n.animation.currentTime=a,n.playbackRate){case"paused":n.animation.pause();break;case"running":case"finished":n.animation.play()}}}}},{key:"startTime",get:function(){var t=b.get(this);return t.timeline?t.startTime:t.animation.startTime},set:function(t){var e=b.get(this);if(e.timeline){var n=e.timeline.currentTime;null===n&&null!==t&&(e.holdTime=null);var i=this.currentTime;v(e),e.startTime=t,e.resetCurrentTimeOnResume=!1,e.readyPromise=null,null===t?(e.holdTime=i,e.playState=null===i?"idle":"paused"):(e.playState="running",null!==n&&(e.animation.currentTime=(n-t)*this.playbackRate,S(e)))}else e.animation.startTime=t}},{key:"currentTime",get:function(){var t=b.get(this);return t.timeline?t.playState&&"idle"!=t.playState?"running"==t.playState&&"inactive"==t.timeline.phase?null:t.animation.currentTime:null:t.animation.currentTime},set:function(t){var e=b.get(this);if(e.animation.currentTime=t,e.resetCurrentTimeOnResume=!1,e.timeline){var n=e.timeline.currentTime,i=this.playbackRate;switch(e.playState){case"running":case"finished":e.startTime=n-t/i,e.holdTime=null;break;default:e.playState=t?"paused":"idle",e.holdTime=t,e.startTime=null}S(e)}}},{key:"playbackRate",get:function(){return b.get(this).animation.playbackRate},set:function(t){var e=b.get(this);e.animation.playbackRate=t,e.pendingPlaybackRate=null,S(e)}},{key:"playState",get:function(){return proxy=b.get(this),proxy.timeline?proxy.playState:proxy.animation.playState}},{key:"replaceState",get:function(){return b.get(this).animation.pending}},{key:"pending",get:function(){var t=b.get(this);return t.timeline?!!t.readyPromise:t.animation.pending}},{key:"id",get:function(){return b.get(this).animation.id}},{key:"onfinish",get:function(){return b.get(this).animation.onfinish},set:function(t){b.get(this).animation.onfinish=t}},{key:"oncancel",get:function(){return b.get(this).animation.oncancel},set:function(t){b.get(this).animation.oncancel=t}},{key:"onremove",get:function(){return b.get(this).animation.onremove},set:function(t){b.get(this).animation.onremove=t}},{key:"finished",get:function(){b.get(this)}},{key:"ready",get:function(){var t=b.get(this);return t.timeline?t.readyPromise?t.readyPromise:null:t.animation.ready}}]),t}(),w=new WeakMap,O=[[[0,1,2,3]],[[0,2],[1,3]],[[0],[1,3],[2]],[[0],[1],[2],[3]]],R=function(){function t(t){w.set(this,{target:null,edge:"start",threshold:0,rootMargin:[[0,"px"],[0,"px"],[0,"px"],[0,"px"]]}),this.target=t.target,this.edge=t.edge||"start",this.threshold=t.threshold||0,this.rootMargin=t.rootMargin||"0px 0px 0px 0px",this.clamp=t.clamp||!1}return e(t,[{key:"target",set:function(t){if(!(t instanceof Element))throw w.get(this).target=null,Error("Intersection target must be an element.");w.get(this).target=t},get:function(){return w.get(this).target}},{key:"edge",set:function(t){-1!=["start","end"].indexOf(t)&&(w.get(this).edge=t)},get:function(){return w.get(this).edge}},{key:"threshold",set:function(t){var e=parseFloat(t);if(e!=e)throw TypeError("Invalid threshold.");if(e<0||e>1)throw TypeError("threshold must be in the range [0, 1]");w.get(this).threshold=e},get:function(){return w.get(this).threshold}},{key:"rootMargin",set:function(t){var e=t.split(/ +/);if(e.length<1||e.length>4)throw TypeError("rootMargin must contain between 1 and 4 length components");for(var n=[[],[],[],[]],i=0;i<e.length;i++){var a=r(e[i],!0);if(!a)throw TypeError("Unrecognized rootMargin length");for(var o=O[e.length-1][i],l=0;l<o.length;l++)n[o[l]]=[parseFloat(a.value),a.unit]}w.get(this).rootMargin=n},get:function(){return w.get(this).rootMargin.map(function(t){return t.join("")}).join(" ")}},{key:"clamp",set:function(t){w.get(this).clamp=!!t}}]),t}();if(l.push({parse:function(t){if(t.target)return new R(t)},evaluate:function(t,e,n,i){"block"==e?e="vertical":"inline"==e&&(e="horizontal");for(var r,a=t==document.scrollingElement?{left:0,right:t.clientWidth,top:0,bottom:t.clientHeight,width:t.clientWidth,height:t.clientHeight}:t.getBoundingClientRect(),o=w.get(n).rootMargin,l=[],s=0;s<4;s++)l.push("percent"==(r=o[s])[1]?r[0]*(s%2==0?a.height:a.width)/100:r[0]);var u=a.left-l[3],c=a.right-a.left+l[3]+l[1],f=a.top-l[0],m=a.bottom-a.top+l[0]+l[2],h=w.get(n).clamp,g=n.target.getBoundingClientRect(),d=n.threshold;if("start"==n.edge&&(d=1-d),"vertical"==e){var p=g.top+g.height*d-f+t.scrollTop;return h?"end"==n.edge?Math.max(0,p-m):Math.min(p,t.scrollHeight-m):"end"==n.edge?p-m:p}var y=g.left+g.width*d-u+t.scrollLeft;return h?"end"==n.edge?Math.max(0,y-c):Math.min(y,t.scrollWidth-c):"end"==n.edge?y-c:y}}),!Reflect.defineProperty(window,"ScrollTimeline",{value:h}))throw Error("Error installing ScrollTimeline polyfill: could not attach ScrollTimeline to window");if(!Reflect.defineProperty(Element.prototype,"animate",{value:function(t,e){var n=e.timeline;n instanceof h&&delete e.timeline;var i=g.apply(this,[t,e]),r=new k(i,n);return n instanceof h&&(i.pause(),r.play()),r}}))throw Error("Error installing ScrollTimeline polyfill: could not attach WAAPI's animate to DOM Element");if(!Reflect.defineProperty(window,"Animation",{value:k}))throw Error("Error installing Animation constructor.")}();
//# sourceMappingURL=scroll-timeline.js.map
